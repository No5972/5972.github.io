<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title id="t">Pixiv 日榜 Top 50</title>
	
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js">
</script>
</head>
<body>

	<h1 style="text-align: center">Pixiv 日榜 Top 50 - <span id="date"></span></h1>
	<p id="status" style="text-align: center">准备加载</p>
	<p style="text-align: center"><button id="begin">点击开始欣赏</button></p>
	
	<p style="text-align: center">
本接口调用了pimg.tw的镜像缓存服务。<br/>
<span style="font-weight: bold; color: red">本接口已经接入百度智能云自动去除部分不适宜图片，所以实际加载的图片可能少于50张。</span><br/>
<span style="color: blue">若提示“没有图片”则是由于后台调用百度智能云时出现故障。请联系站长反馈。</span></br/>
本站该接口无任何本站后台记录的提交数据，源代码可查看。<br/>
所有加载图片均由Pixiv提供，加载显示的图片内容与本站无关，不代表本站立场。<br/>
图片版权归各作品作者所有，严禁商用。<br/>
如发现任何不良信息请及时向站长反馈。<br/>
	</p>
	
	<script>	
		function loadJS( url, callback ){	
			var script = document.createElement('script'),fn = callback || function(){};	
			script.type = 'text/javascript';	
			//IE	
			if(script.readyState){	
				script.onreadystatechange = function(){	
					if( script.readyState == 'loaded' || script.readyState == 'complete' ){	
						script.onreadystatechange = null;	
						fn();	
					}	
				};	
			}else{	
				//其他浏览器	
				script.onload = function(){	
					fn();	
				};	
			}	
			script.src = url;	
			document.getElementsByTagName('head')[0].appendChild(script);	
		}	

		var current = new Date(new Date().getTime() + new Date().getTimezoneOffset() * 60000);	
		if (current.getHours() < 6) {	
			current.setTime(new Date().getTime() - 86400 * 1000)	
		}	

		$("#date").text(current.toLocaleDateString())	
		$("#t").text("Pixiv 日榜 Top 50 - " + current.toLocaleDateString());	
		$("#status").text("正在加载！");	

		var pictures = {	
			"title": "Pixiv 日榜 " + new Date().toLocaleDateString(),	
			"id": 123,	
			"start": 0,	
			"data": []	
		}	

		$.get("https://api.github.com/repos/No5972/pixiv-github-action/git/trees/runner", function(data) { 	
			console.log (data) ;	
			for (var x in data.tree) {	
				if (data.tree[x].path.lastIndexOf(".jpg") != -1 || data.tree[x].path.lastIndexOf(".png") != -1) {	
					var currentUrl = "https://imageproxy.pimg.tw/resize?url=https://raw.githubusercontent.com/No5972/pixiv-github-action/runner/" + encodeURI(data.tree[x].path);	
					pictures.data.push({"alt": data.tree[x].path.substring(0, data.tree[x].path.indexOf("_")) + " - " + data.tree[x].path.substring(data.tree[x].path.indexOf("_") + 1, data.tree[x].path.length - 4), "pid": data.tree[x].path.substring(0, data.tree[x].path.indexOf("_")), "src": currentUrl, "thumb": currentUrl + "&maxwidth=640"});	
				}	
				loadJS("https://cdn.bootcdn.net/ajax/libs/layer/3.1.1/layer.min.js?v=" + new Date().getTime(), function () {	
					$("#begin").click(function () {	
						layer.photos({	
							photos: pictures	
							,anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）	
						});	
					});	
					$("#status").text("加载完成，点击按钮即可开始欣赏");	
				});	
			}	
		});	
	</script>

</body>
</html>
